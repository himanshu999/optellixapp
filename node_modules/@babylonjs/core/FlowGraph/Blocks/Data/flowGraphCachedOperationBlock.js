import { FlowGraphBlock } from "../../flowGraphBlock.js";
const CACHE_NAME = "cachedOperationValue";
const CACHE_EXEC_ID_NAME = "cachedExecutionId";
/**
 * @experimental
 */
export class FlowGraphCachedOperationBlock extends FlowGraphBlock {
    constructor(outputRichType, config) {
        super(config);
        this.value = this.registerDataOutput("value", outputRichType);
    }
    _updateOutputs(context) {
        const cachedExecutionId = context._getExecutionVariable(this, CACHE_EXEC_ID_NAME);
        const cachedValue = context._getExecutionVariable(this, CACHE_NAME);
        if (cachedValue !== undefined && cachedExecutionId === context.executionId) {
            this.value.setValue(cachedValue, context);
        }
        else {
            const calculatedValue = this._doOperation(context);
            context._setExecutionVariable(this, CACHE_NAME, calculatedValue);
            context._setExecutionVariable(this, CACHE_EXEC_ID_NAME, context.executionId);
            this.value.setValue(calculatedValue, context);
        }
    }
}
//# sourceMappingURL=flowGraphCachedOperationBlock.js.map