{"version":3,"file":"gaussianSplatting.js","sourceRoot":"","sources":["../../../../../dev/core/src/Rendering/GaussianSplatting/gaussianSplatting.ts"],"names":[],"mappings":"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","sourcesContent":["import { Effect } from \"../../Materials/effect\";\r\nimport { ShaderMaterial } from \"../../Materials/shaderMaterial\";\r\nimport { Matrix, Quaternion, TmpVectors, Vector2, Vector3 } from \"../../Maths/math.vector\";\r\nimport { Mesh } from \"../../Meshes/mesh\";\r\nimport { VertexData } from \"../../Meshes/mesh.vertexData\";\r\nimport type { Observer } from \"../../Misc/observable\";\r\nimport { Tools } from \"../../Misc/tools\";\r\nimport type { Scene } from \"../../scene\";\r\nimport type { Nullable } from \"../../types\";\r\n\r\n/**\r\n * @experimental\r\n * Helper class that loads, creates and manipulates a Gaussian Splatting\r\n */\r\nexport class GaussianSplatting {\r\n    private _vertexCount: number = 0;\r\n    private _positions: Float32Array;\r\n    private _uBuffer: Uint8Array;\r\n    private _covA: Float32Array;\r\n    private _covB: Float32Array;\r\n    private _sceneDisposeObserver: Nullable<Observer<Scene>>;\r\n    private _sceneBeforeRenderObserver: Nullable<Observer<Scene>>;\r\n    private _material: ShaderMaterial;\r\n    private _modelViewMatrix = Matrix.Identity();\r\n    private _minimum = new Vector3();\r\n    private _maximum = new Vector3();\r\n    /**\r\n     * Name of the GS that is also used to name a mesh for rendering it\r\n     */\r\n    public readonly name: string = \"GaussianSplatting\";\r\n    /**\r\n     * The scene the Gaussian Splatting mesh belongs to\r\n     */\r\n    public readonly scene: Scene;\r\n    /**\r\n     * The mesh responsible for rendering the GS\r\n     */\r\n    public mesh: Nullable<Mesh>;\r\n\r\n    /**\r\n     * Return the number of splattings used\r\n     */\r\n    public get vertexCount(): number {\r\n        return this._vertexCount;\r\n    }\r\n\r\n    /**\r\n     * Shader material with alpha blending\r\n     * @param scene parent scene\r\n     */\r\n    private _createMaterial(scene: Scene) {\r\n        Effect.ShadersStore[\"gaussianSplattingVertexShader\"] = GaussianSplatting._VertexShaderSource;\r\n        Effect.ShadersStore[\"gaussianSplattingFragmentShader\"] = GaussianSplatting._FragmentShaderSource;\r\n        const shaderMaterial = new ShaderMaterial(\r\n            \"GaussianSplattingShader\",\r\n            scene,\r\n            {\r\n                vertex: \"gaussianSplatting\",\r\n                fragment: \"gaussianSplatting\",\r\n            },\r\n            {\r\n                attributes: [\"position\"],\r\n                uniforms: [\"projection\", \"modelView\", \"viewport\"],\r\n            }\r\n        );\r\n        shaderMaterial.backFaceCulling = false;\r\n        shaderMaterial.alpha = 0.9999;\r\n        this._material = shaderMaterial;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param scene parent scene\r\n     * @returns A simple 2 triangles quad\r\n     */\r\n    private _getMesh(scene: Scene): Mesh {\r\n        const mesh = new Mesh(this.name, scene);\r\n        const vertexData = new VertexData();\r\n        vertexData.positions = [-2, -2, 0, 2, -2, 0, 2, 2, 0, -2, 2, 0];\r\n        vertexData.indices = [0, 1, 2, 0, 2, 3];\r\n        vertexData.applyToMesh(mesh);\r\n        const binfo = mesh.getBoundingInfo();\r\n        binfo.reConstruct(this._minimum, this._maximum);\r\n        binfo.isLocked = true;\r\n        mesh.doNotSyncBoundingInfo = true;\r\n        mesh.material = this._material;\r\n        return mesh;\r\n    }\r\n\r\n    protected _worker: Nullable<Worker> = null;\r\n    protected static _VertexShaderSource = `\r\n        precision mediump float;\r\n        attribute vec2 position;\r\n\r\n        attribute vec4 world0;\r\n        attribute vec4 world1;\r\n        attribute vec4 world2;\r\n        attribute vec4 world3;\r\n\r\n        uniform mat4 projection, modelView;\r\n        uniform vec2 viewport;\r\n\r\n        varying vec4 vColor;\r\n        varying vec2 vPosition;\r\n        void main () {\r\n        vec3 center = world0.xyz;\r\n        vec4 color = world1;\r\n        vec3 covA = world2.xyz;\r\n        vec3 covB = world3.xyz;\r\n\r\n        vec4 camspace = modelView * vec4(center, 1);\r\n        vec4 pos2d = projection * camspace;\r\n\r\n        float bounds = 1.2 * pos2d.w;\r\n        if (pos2d.z < -pos2d.w || pos2d.x < -bounds || pos2d.x > bounds\r\n            || pos2d.y < -bounds || pos2d.y > bounds) {\r\n            gl_Position = vec4(0.0, 0.0, 2.0, 1.0);\r\n            return;\r\n        }\r\n\r\n        mat3 Vrk = mat3(\r\n            covA.x, covA.y, covA.z, \r\n            covA.y, covB.x, covB.y,\r\n            covA.z, covB.y, covB.z\r\n        );\r\n        vec2 focal = vec2(1132., 1132.);\r\n        mat3 J = mat3(\r\n            focal.x / camspace.z, 0., -(focal.x * camspace.x) / (camspace.z * camspace.z), \r\n            0., focal.y / camspace.z, -(focal.y * camspace.y) / (camspace.z * camspace.z), \r\n            0., 0., 0.\r\n        );\r\n\r\n        mat3 invy = mat3(1,0,0, 0,-1,0,0,0,1);\r\n\r\n        mat3 T = invy * transpose(mat3(modelView)) * J;\r\n        mat3 cov2d = transpose(T) * Vrk * T;\r\n\r\n        float mid = (cov2d[0][0] + cov2d[1][1]) / 2.0;\r\n        float radius = length(vec2((cov2d[0][0] - cov2d[1][1]) / 2.0, cov2d[0][1]));\r\n        float lambda1 = mid + radius, lambda2 = mid - radius;\r\n\r\n        if(lambda2 < 0.0) return;\r\n        vec2 diagonalVector = normalize(vec2(cov2d[0][1], lambda1 - cov2d[0][0]));\r\n        vec2 majorAxis = min(sqrt(2.0 * lambda1), 1024.0) * diagonalVector;\r\n        vec2 minorAxis = min(sqrt(2.0 * lambda2), 1024.0) * vec2(diagonalVector.y, -diagonalVector.x);\r\n\r\n        vColor = color;\r\n        vPosition = position;\r\n        vec2 vCenter = vec2(pos2d);\r\n        gl_Position = vec4(\r\n            vCenter \r\n            + (position.x * majorAxis * 1. / viewport \r\n            + position.y * minorAxis * 1. / viewport) * pos2d.w, pos2d.zw);\r\n        }`;\r\n\r\n    protected static _FragmentShaderSource = `\r\n        precision highp float;\r\n        varying vec4 vColor;\r\n        varying vec2 vPosition;\r\n        void main () {    \r\n        float A = -dot(vPosition, vPosition);\r\n        if (A < -4.0) discard;\r\n        float B = exp(A) * vColor.a;\r\n        gl_FragColor = vec4(vColor.rgb, B);\r\n        }`;\r\n\r\n    protected static _CreateWorker = function (self: Worker) {\r\n        let viewProj: number[];\r\n        let lastProj: number[] = [];\r\n        let vertexCount = 0;\r\n        let positions: Float32Array;\r\n\r\n        const runSort = (viewProj: number[]) => {\r\n            vertexCount = positions.length;\r\n            const depthMix = new BigInt64Array(vertexCount);\r\n            const indices = new Uint32Array(depthMix.buffer);\r\n            for (let j = 0; j < vertexCount; j++) {\r\n                indices[2 * j] = j;\r\n            }\r\n\r\n            const floatMix = new Float32Array(depthMix.buffer);\r\n            for (let j = 0; j < vertexCount; j++) {\r\n                floatMix[2 * j + 1] = 10000 - (viewProj[2] * positions[3 * j + 0] + viewProj[6] * positions[3 * j + 1] + viewProj[10] * positions[3 * j + 2]);\r\n            }\r\n            lastProj = viewProj;\r\n\r\n            depthMix.sort();\r\n\r\n            self.postMessage({ depthMix }, [depthMix.buffer]);\r\n        };\r\n\r\n        let sortRunning: boolean = false;\r\n        const throttledSort = () => {\r\n            if (!sortRunning) {\r\n                sortRunning = true;\r\n                const lastView = viewProj;\r\n                runSort(lastView);\r\n                setTimeout(() => {\r\n                    sortRunning = false;\r\n                    if (lastView !== viewProj) {\r\n                        throttledSort();\r\n                    }\r\n                }, 0);\r\n            }\r\n        };\r\n\r\n        self.onmessage = (e: any) => {\r\n            viewProj = e.data.view;\r\n            const dot = lastProj[2] * viewProj[2] + lastProj[6] * viewProj[6] + lastProj[10] * viewProj[10];\r\n            if (Math.abs(dot - 1) < 0.01) {\r\n                return;\r\n            }\r\n            positions = e.data.positions;\r\n            throttledSort();\r\n        };\r\n    };\r\n\r\n    protected _setData(binaryData: Uint8Array) {\r\n        const rowLength = 3 * 4 + 3 * 4 + 4 + 4;\r\n        this._vertexCount = binaryData.length / rowLength;\r\n        const vertexCount = this._vertexCount;\r\n        this._positions = new Float32Array(3 * vertexCount);\r\n        this._covA = new Float32Array(3 * vertexCount);\r\n        this._covB = new Float32Array(3 * vertexCount);\r\n\r\n        const f_buffer = new Float32Array(binaryData.buffer);\r\n        this._uBuffer = new Uint8Array(binaryData.buffer);\r\n\r\n        const matrixRotation = Matrix.Zero();\r\n        const matrixScale = Matrix.Zero();\r\n        const quaternion = Quaternion.Identity();\r\n\r\n        this._minimum.set(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE);\r\n        this._maximum.set(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE);\r\n\r\n        for (let i = 0; i < vertexCount; i++) {\r\n            const x = f_buffer[8 * i + 0];\r\n            const y = -f_buffer[8 * i + 1];\r\n            const z = f_buffer[8 * i + 2];\r\n\r\n            this._positions[3 * i + 0] = x;\r\n            this._positions[3 * i + 1] = y;\r\n            this._positions[3 * i + 2] = z;\r\n\r\n            this._minimum.minimizeInPlaceFromFloats(x, y, z);\r\n            this._maximum.maximizeInPlaceFromFloats(x, y, z);\r\n\r\n            quaternion.set(\r\n                (this._uBuffer[32 * i + 28 + 1] - 128) / 128,\r\n                (this._uBuffer[32 * i + 28 + 2] - 128) / 128,\r\n                (this._uBuffer[32 * i + 28 + 3] - 128) / 128,\r\n                -(this._uBuffer[32 * i + 28 + 0] - 128) / 128\r\n            );\r\n            quaternion.toRotationMatrix(matrixRotation);\r\n\r\n            Matrix.ScalingToRef(f_buffer[8 * i + 3 + 0] * 2, f_buffer[8 * i + 3 + 1] * 2, f_buffer[8 * i + 3 + 2] * 2, matrixScale);\r\n\r\n            const M = matrixRotation.multiplyToRef(matrixScale, TmpVectors.Matrix[0]).m;\r\n\r\n            this._covA[i * 3 + 0] = M[0] * M[0] + M[1] * M[1] + M[2] * M[2];\r\n            this._covA[i * 3 + 1] = M[0] * M[4] + M[1] * M[5] + M[2] * M[6];\r\n            this._covA[i * 3 + 2] = M[0] * M[8] + M[1] * M[9] + M[2] * M[10];\r\n            this._covB[i * 3 + 0] = M[4] * M[4] + M[5] * M[5] + M[6] * M[6];\r\n            this._covB[i * 3 + 1] = M[4] * M[8] + M[5] * M[9] + M[6] * M[10];\r\n            this._covB[i * 3 + 2] = M[8] * M[8] + M[9] * M[9] + M[10] * M[10];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Construct a Gaussian Splatting proxy object\r\n     * @param name name of the mesh used for rendering\r\n     * @param scene scene it belongs to\r\n     */\r\n    public constructor(name: string, scene: Scene) {\r\n        this.scene = scene;\r\n        this.name = name;\r\n        this._createMaterial(scene);\r\n        this._worker?.terminate();\r\n        this._worker = null;\r\n    }\r\n\r\n    private _loadData(data: ArrayBuffer) {\r\n        if (this.mesh) {\r\n            this.dispose();\r\n        }\r\n        this._setData(new Uint8Array(data as any));\r\n        const matricesData = new Float32Array(this.vertexCount * 16);\r\n\r\n        const updateInstances = (indexMix: Uint32Array) => {\r\n            for (let j = 0; j < this.vertexCount; j++) {\r\n                const i = indexMix[2 * j];\r\n                const index = j * 16;\r\n                matricesData[index + 0] = this._positions[i * 3 + 0];\r\n                matricesData[index + 1] = this._positions[i * 3 + 1];\r\n                matricesData[index + 2] = this._positions[i * 3 + 2];\r\n\r\n                matricesData[index + 4] = this._uBuffer[32 * i + 24 + 0] / 255;\r\n                matricesData[index + 5] = this._uBuffer[32 * i + 24 + 1] / 255;\r\n                matricesData[index + 6] = this._uBuffer[32 * i + 24 + 2] / 255;\r\n                matricesData[index + 7] = this._uBuffer[32 * i + 24 + 3] / 255;\r\n\r\n                matricesData[index + 8] = this._covA[i * 3 + 0];\r\n                matricesData[index + 9] = this._covA[i * 3 + 1];\r\n                matricesData[index + 10] = this._covA[i * 3 + 2];\r\n\r\n                matricesData[index + 12] = this._covB[i * 3 + 0];\r\n                matricesData[index + 13] = this._covB[i * 3 + 1];\r\n                matricesData[index + 14] = this._covB[i * 3 + 2];\r\n            }\r\n\r\n            this.mesh?.thinInstanceBufferUpdated(\"matrix\");\r\n        };\r\n\r\n        // update so this.mesh is valid when exiting this function\r\n        this.mesh = this._getMesh(this.scene);\r\n        this.mesh.thinInstanceSetBuffer(\"matrix\", matricesData, 16, false);\r\n\r\n        this._worker = new Worker(\r\n            URL.createObjectURL(\r\n                new Blob([\"(\", GaussianSplatting._CreateWorker.toString(), \")(self)\"], {\r\n                    type: \"application/javascript\",\r\n                })\r\n            )\r\n        );\r\n\r\n        this._worker.onmessage = (e) => {\r\n            const indexMix = new Uint32Array(e.data.depthMix.buffer);\r\n            updateInstances(indexMix);\r\n        };\r\n        const viewport = new Vector2();\r\n        this._sceneBeforeRenderObserver = this.scene.onBeforeRenderObservable.add(() => {\r\n            const engine = this.scene.getEngine();\r\n            viewport.set(engine.getRenderWidth(), engine.getRenderHeight());\r\n            this._material.setVector2(\"viewport\", viewport);\r\n            const meshWorldMatrix = this.mesh!.getWorldMatrix();\r\n            meshWorldMatrix.multiplyToRef(this.scene.activeCamera!.getViewMatrix(), this._modelViewMatrix);\r\n            const binfo = this.mesh!.getBoundingInfo();\r\n            binfo.reConstruct(this._minimum, this._maximum, meshWorldMatrix);\r\n            binfo.isLocked = true;\r\n            this._material.setMatrix(\"modelView\", this._modelViewMatrix);\r\n            this._worker?.postMessage({ view: this._modelViewMatrix.m, positions: this._positions });\r\n        });\r\n        this._sceneDisposeObserver = this.scene.onDisposeObservable.add(() => {\r\n            this.dispose();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Loads a .splat Gaussian Splatting array buffer asynchronously\r\n     * @param data arraybuffer containing splat file\r\n     * @returns a promise that resolves when the operation is complete\r\n     */\r\n\r\n    public loadDataAsync(data: ArrayBuffer): Promise<void> {\r\n        return Promise.resolve(this._loadData(data));\r\n    }\r\n    /**\r\n     * Loads a .splat Gaussian Splatting file asynchronously\r\n     * @param url path to the splat file to load\r\n     * @returns a promise that resolves when the operation is complete\r\n     */\r\n    public loadFileAsync(url: string): Promise<void> {\r\n        return Tools.LoadFileAsync(url, true).then((data) => {\r\n            this._loadData(data);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Clear datas used for Gaussian Splatting and associated resources\r\n     */\r\n    public dispose(): void {\r\n        this.scene.onDisposeObservable.remove(this._sceneDisposeObserver);\r\n        this.scene.onBeforeRenderObservable.remove(this._sceneBeforeRenderObserver);\r\n        this._worker?.terminate();\r\n        this._worker = null;\r\n        this.mesh?.dispose();\r\n        this.mesh = null;\r\n    }\r\n}\r\n"]}